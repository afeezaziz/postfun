{% extends 'base.html' %}
{% block title %}{{ user.display_name or user.npub or 'User' }} | Postfun{% endblock %}
{% block content %}
  <!-- User Profile Header -->
  <section class="hero bg-terminal-black border-2 border-terminal-green p-6 rounded-lg shadow-lg mb-8">
    <div class="hero-content">
      <div class="flex flex-col md:flex-row items-center gap-6">
        <!-- Profile Avatar -->
        <div class="w-24 h-24 rounded-full bg-terminal-black border-4 border-terminal-green flex items-center justify-center">
          <span class="text-4xl text-terminal-green">ğŸ‘¤</span>
        </div>

        <!-- Profile Info -->
        <div class="text-center md:text-left flex-1">
          <!-- Display Name with Twitter Connection Indicator -->
          <div class="flex items-center gap-3 mb-2">
            <h1 class="text-3xl md:text-4xl font-bold text-terminal-green font-terminal">
              {% if twitter_user and profile_type == 'twitter' %}
                {{ twitter_user.display_name or twitter_user.username }}
              {% else %}
                {{ user.display_name or 'Nostr User' }}
              {% endif %}
            </h1>
            {% if twitter_connection %}
              <div class="terminal-badge border-2 border-blue-500 px-2 py-1">
                <span class="text-blue-400">ğŸ¦</span>
              </div>
            {% endif %}
          </div>

          <!-- Profile Identifiers -->
          <div class="space-y-2 mb-4">
            {% if profile_type == 'twitter' and twitter_user %}
              <p class="text-terminal-dim-green text-lg">
                @{{ twitter_user.username }}
                {% if twitter_user.verified %}
                  <span class="text-blue-400 ml-2">âœ“</span>
                {% endif %}
              </p>
              <p class="text-terminal-dim-green text-sm">
                Connected Nostr: {{ user.npub[:16] }}...{{ user.npub[-4:] if user.npub else 'Unknown' }}
              </p>
            {% else %}
              <p class="text-terminal-dim-green text-lg">
                {{ user.npub[:16] }}...{{ user.npub[-4:] if user.npub else 'Unknown' }}
              </p>
              {% if twitter_connection %}
                <p class="text-terminal-dim-green text-sm">
                  Also on Twitter: @{{ twitter_user.username }}
                </p>
              {% endif %}
            {% endif %}
          </div>

          <!-- Quick Stats -->
          <div class="flex flex-wrap gap-3 justify-center md:justify-start">
            <div class="terminal-badge border-2 border-terminal-green px-3 py-1">
              <span class="text-terminal-green">ğŸ“… Joined {{ user.created_at.strftime('%b %Y') }}</span>
            </div>
            <div class="terminal-badge border-2 border-terminal-green px-3 py-1">
              <span class="text-terminal-green">ğŸ†” ID: {{ user.id }}</span>
            </div>
            {% if twitter_user and twitter_user.followers_count %}
              <div class="terminal-badge border-2 border-terminal-green px-3 py-1">
                <span class="text-terminal-green">ğŸ‘¥ {{ twitter_user.followers_count | number_format }} followers</span>
              </div>
            {% endif %}
            {% if user.is_active %}
              <div class="terminal-badge border-2 border-terminal-green px-3 py-1">
                <span class="text-terminal-green">âœ… Active</span>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col gap-2">
          <a href="{{ url_for('web.users.portfolio') }}" class="terminal-button">
            ğŸ’¼ Portfolio
          </a>
          <a href="{{ url_for('web.users.wallet') }}" class="terminal-button">
            âš¡ Wallet
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Twitter Information (if available) -->
  {% if twitter_user %}
  <section class="terminal-card bg-terminal-black border-2 border-blue-500 p-6 rounded-lg shadow-lg mb-8">
    <h2 class="text-2xl font-bold text-blue-400 font-terminal mb-6 flex items-center">
      <span class="mr-2">ğŸ¦</span> Twitter Profile
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Twitter Basic Info -->
      <div class="terminal-card bg-terminal-black border border-blue-500 p-5 rounded-lg">
        <h3 class="text-lg font-bold text-blue-400 mb-4 flex items-center">
          <span class="mr-2">â„¹ï¸</span> Profile Information
        </h3>
        <div class="space-y-3">
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Username</label>
            <div class="text-blue-400 font-terminal">@{{ twitter_user.username }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Display Name</label>
            <div class="text-terminal-green font-terminal">{{ twitter_user.display_name or 'Not set' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Twitter ID</label>
            <div class="text-terminal-green font-terminal">{{ twitter_user.twitter_user_id }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Verified</label>
            <div class="text-terminal-green font-terminal">
              {% if twitter_user.verified %}
                <span class="text-blue-400">âœ“ Yes</span>
              {% else %}
                No
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Twitter Stats -->
      <div class="terminal-card bg-terminal-black border border-blue-500 p-5 rounded-lg">
        <h3 class="text-lg font-bold text-blue-400 mb-4 flex items-center">
          <span class="mr-2">ğŸ“Š</span> Twitter Statistics
        </h3>
        <div class="space-y-3">
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Followers</label>
            <div class="text-terminal-green font-terminal">{{ twitter_user.followers_count | number_format if twitter_user.followers_count else '0' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Following</label>
            <div class="text-terminal-green font-terminal">{{ twitter_user.following_count | number_format if twitter_user.following_count else '0' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Tweets</label>
            <div class="text-terminal-green font-terminal">{{ twitter_user.tweet_count | number_format if twitter_user.tweet_count else '0' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Connected</label>
            <div class="text-terminal-green font-terminal">{{ twitter_connection.connected_at.strftime('%b %d, %Y') }}</div>
          </div>
        </div>
      </div>
    </div>

    {% if twitter_user.description %}
    <div class="mt-6">
      <h3 class="text-lg font-bold text-blue-400 mb-3 flex items-center">
        <span class="mr-2">ğŸ“</span> Bio
      </h3>
      <div class="terminal-card bg-terminal-black border border-blue-500 p-4 rounded-lg">
        <p class="text-terminal-dim-green">{{ twitter_user.description }}</p>
      </div>
    </div>
    {% endif %}

    {% if twitter_user.location or twitter_user.website %}
    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
      {% if twitter_user.location %}
      <div>
        <h3 class="text-lg font-bold text-blue-400 mb-3 flex items-center">
          <span class="mr-2">ğŸ“</span> Location
        </h3>
        <div class="terminal-card bg-terminal-black border border-blue-500 p-4 rounded-lg">
          <p class="text-terminal-dim-green">{{ twitter_user.location }}</p>
        </div>
      </div>
      {% endif %}
      {% if twitter_user.website %}
      <div>
        <h3 class="text-lg font-bold text-blue-400 mb-3 flex items-center">
          <span class="mr-2">ğŸŒ</span> Website
        </h3>
        <div class="terminal-card bg-terminal-black border border-blue-500 p-4 rounded-lg">
          <a href="{{ twitter_user.website }}" target="_blank" class="text-blue-400 hover:text-blue-300 break-all">{{ twitter_user.website }}</a>
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </section>
  {% endif %}

  <!-- User Details Grid -->
  <section class="terminal-card bg-terminal-black border-2 border-terminal-green p-6 rounded-lg shadow-lg mb-8">
    <h2 class="text-2xl font-bold text-terminal-green font-terminal mb-6 flex items-center">
      <span class="mr-2">ğŸ“‹</span> User Details
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Identity Information -->
      <div class="terminal-card bg-terminal-black border border-terminal-green p-5 rounded-lg">
        <h3 class="text-lg font-bold text-terminal-green mb-4 flex items-center">
          <span class="mr-2">ğŸ”</span> Identity
        </h3>
        <div class="space-y-3">
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Display Name</label>
            <div class="text-terminal-green font-terminal">{{ user.display_name or 'Not set' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Nostr Public Key (npub)</label>
            <div class="text-terminal-green font-terminal text-sm break-all">{{ user.npub or 'Not available' }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Hex Public Key</label>
            <div class="text-terminal-green font-terminal text-sm break-all">{{ user.pubkey_hex }}</div>
          </div>
        </div>
      </div>

      <!-- Account Information -->
      <div class="terminal-card bg-terminal-black border border-terminal-green p-5 rounded-lg">
        <h3 class="text-lg font-bold text-terminal-green mb-4 flex items-center">
          <span class="mr-2">âš™ï¸</span> Account
        </h3>
        <div class="space-y-3">
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">User ID</label>
            <div class="text-terminal-green font-terminal">{{ user.id }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Joined Date</label>
            <div class="text-terminal-green font-terminal">{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
          </div>
          <div>
            <label class="block text-terminal-dim-green text-sm mb-1">Account Status</label>
            <div class="text-terminal-green font-terminal">
              {% if user.is_active %}Active{% else %}Inactive{% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Activity Overview -->
  <section class="terminal-card bg-terminal-black border-2 border-terminal-green p-6 rounded-lg shadow-lg mb-8">
    <h2 class="text-2xl font-bold text-terminal-green font-terminal mb-6 flex items-center">
      <span class="mr-2">ğŸ“Š</span> Activity Overview
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Trading Activity -->
      <div class="terminal-card bg-terminal-black border border-terminal-green p-5 rounded-lg text-center">
        <div class="text-3xl text-terminal-green mb-2">ğŸ“ˆ</div>
        <h3 class="text-lg font-bold text-terminal-green mb-2">Trading</h3>
        <div class="space-y-2">
          <div class="text-terminal-dim-green text-sm">Total Trades</div>
          <div class="text-terminal-green font-bold text-xl">{{ user_stats.total_trades or 0 }}</div>
          <div class="text-terminal-dim-green text-sm">Volume</div>
          <div class="text-terminal-green font-bold">{{ user_stats.total_volume or 0 | round(2) }} gUSD</div>
        </div>
      </div>

      <!-- Token Activity -->
      <div class="terminal-card bg-terminal-black border border-terminal-green p-5 rounded-lg text-center">
        <div class="text-3xl text-terminal-green mb-2">ğŸª™</div>
        <h3 class="text-lg font-bold text-terminal-green mb-2">Tokens</h3>
        <div class="space-y-2">
          <div class="text-terminal-dim-green text-sm">Tokens Created</div>
          <div class="text-terminal-green font-bold text-xl">{{ user_stats.tokens_created or 0 }}</div>
          <div class="text-terminal-dim-green text-sm">Holdings</div>
          <div class="text-terminal-green font-bold">{{ user_stats.holdings_count or 0 }}</div>
        </div>
      </div>

      <!-- Portfolio Value -->
      <div class="terminal-card bg-terminal-black border border-terminal-green p-5 rounded-lg text-center">
        <div class="text-3xl text-terminal-green mb-2">ğŸ’°</div>
        <h3 class="text-lg font-bold text-terminal-green mb-2">Portfolio</h3>
        <div class="space-y-2">
          <div class="text-terminal-dim-green text-sm">Total Value</div>
          <div class="text-terminal-green font-bold text-xl">{{ user_stats.portfolio_value or 0 | round(2) }} gUSD</div>
          <div class="text-terminal-dim-green text-sm">24h Change</div>
          <div class="text-terminal-green font-bold">
            {% if user_stats.portfolio_change_24h >= 0 %}+{% endif %}
            {{ user_stats.portfolio_change_24h or 0 | round(2) }}%
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Recent Activity -->
  <section class="terminal-card bg-terminal-black border-2 border-terminal-green p-6 rounded-lg shadow-lg">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-terminal-green font-terminal flex items-center">
        <span class="mr-2">ğŸ•</span> Recent Activity
      </h2>
      <div class="terminal-badge border-2 border-terminal-green px-3 py-1">
        <span class="text-terminal-green">Last 7 days</span>
      </div>
    </div>

    {% if recent_activities %}
      <div class="space-y-4">
        {% for activity in recent_activities %}
          <div class="terminal-card bg-terminal-black border border-terminal-green p-4 rounded-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="text-2xl text-terminal-green">
                  {% if activity.type == 'trade' %}ğŸ“Š
                  {% elif activity.type == 'token_created' %}ğŸš€
                  {% elif activity.type == 'wallet' %}âš¡
                  {% else %}ğŸ“
                  {% endif %}
                </div>
                <div>
                  <div class="text-terminal-green font-bold">{{ activity.title }}</div>
                  <div class="text-terminal-dim-green text-sm">{{ activity.description }}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-terminal-green text-sm">{{ activity.timestamp.strftime('%m/%d %H:%M') }}</div>
                {% if activity.value %}
                  <div class="text-terminal-green font-bold">{{ activity.value }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-12">
        <div class="text-terminal-dim-green text-lg mb-4">No recent activity</div>
        <p class="text-terminal-dim-green mb-6">Start trading or creating tokens to see your activity here</p>
        <div class="flex gap-4 justify-center">
          <a href="{{ url_for('web.tokens.tokens_list') }}" class="terminal-button">
            Browse Tokens
          </a>
          <a href="{{ url_for('web.tokens.launchpad') }}" class="terminal-button">
            Create Token
          </a>
        </div>
      </div>
    {% endif %}
  </section>

  <!-- Nostr Profile Information -->
  {% if user.nostr_profile %}
  <section class="terminal-card bg-terminal-black border-2 border-terminal-green p-6 rounded-lg shadow-lg mt-8">
    <h2 class="text-2xl font-bold text-terminal-green font-terminal mb-6 flex items-center">
      <span class="mr-2">ğŸŒ</span> Nostr Profile
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% if user.nostr_profile.about %}
      <div>
        <label class="block text-terminal-dim-green text-sm mb-2">About</label>
        <div class="terminal-card bg-terminal-black border border-terminal-green p-4 rounded-lg">
          <div class="text-terminal-green">{{ user.nostr_profile.about }}</div>
        </div>
      </div>
      {% endif %}

      {% if user.nostr_profile.website %}
      <div>
        <label class="block text-terminal-dim-green text-sm mb-2">Website</label>
        <a href="{{ user.nostr_profile.website }}" target="_blank" class="terminal-button block text-center">
          ğŸŒ Visit Website
        </a>
      </div>
      {% endif %}

      {% if user.nostr_profile.picture %}
      <div>
        <label class="block text-terminal-dim-green text-sm mb-2">Profile Picture</label>
        <img src="{{ user.nostr_profile.picture }}" alt="Profile" class="w-20 h-20 rounded-full border-2 border-terminal-green" />
      </div>
      {% endif %}
    </div>
  </section>
  {% endif %}
{% endblock %}
