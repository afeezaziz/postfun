{% extends 'base.html' %}
{% block title %}Portfolio | Postfun{% endblock %}
{% block content %}
  <section class="card">
    <h1>Portfolio</h1>

    <!-- Summary Section -->
    <div class="stats shadow">
      <div class="stat place-items-center">
        <div class="stat-title">Total Value</div>
        <div class="stat-value">{{ "%.2f"|format(holdings|sum(attribute='value') or 0) }}</div>
        <div class="stat-desc">gUSD</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">Positions</div>
        <div class="stat-value">{{ holdings|length }}</div>
        <div class="stat-desc">Tokens</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">24h Change</div>
        <div class="stat-value">â€”</div>
        <div class="stat-desc">Combined</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">User</div>
        <div class="stat-value">{{ (user.display_name or 'Trader')[:8] }}</div>
        <div class="stat-desc">Trader</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex justify-center gap-6 my-8">
      <a href="{{ url_for('web.tokens.launchpad') }}" class="btn btn-lg btn-primary shadow-lg">
        <span class="mr-2">ðŸª™</span> Create Token
      </a>
      <a href="{{ url_for('web.users.wallet') }}" class="btn btn-lg btn-secondary shadow-lg">
        <span class="mr-2">âš¡</span> Lightning Wallet
      </a>
    </div>

    <!-- Token Holdings Table -->
    {% if holdings %}
      <div class="overflow-x-auto">
        <div class="flex justify-between items-center mb-4 px-4 py-2 bg-base-200 rounded-lg">
          <span class="text-sm">Token Holdings</span>
          <span class="text-sm">{{ holdings|length }} tokens</span>
        </div>

        <table class="table table-xs">
          <thead>
            <tr>
              <th>Token</th>
              <th>Balance</th>
              <th>Price</th>
              <th>Value</th>
              <th>24h Change</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for h in holdings %}
              {% set token = h.token %}
              <tr>
                <td>
                  <div class="flex items-center gap-2">
                    <span class="badge badge-success">{{ token.symbol }}</span>
                    <span class="font-bold">{{ token.name }}</span>
                  </div>
                </td>
                <td class="font-bold">{{ '%.4f'|format(h.amount or 0) }}</td>
                <td>{{ '%.6f'|format((price_by_symbol.get(token.symbol) if price_by_symbol else None) or (token.price or 0)) }}</td>
                <td class="font-bold text-green-600">{{ '%.2f'|format(h.value or 0) }} gUSD</td>
                <td class="font-bold {% if token.change_24h and token.change_24h >= 0 %}text-green-600{% elif token.change_24h and token.change_24h < 0 %}text-red-600{% endif %}">
                  {% if token.change_24h >= 0 %}+{% endif %}{{ '%.2f'|format(token.change_24h or 0) }}%
                </td>
                <td>
                  <div class="flex gap-1">
                    <a href="{{ url_for('web.tokens.token_detail', symbol=token.symbol) }}" class="btn btn-xs" title="View Details">
                      ðŸ“Š
                    </a>
                    <a href="{{ url_for('web.trading.pool', symbol=token.symbol) }}" class="btn btn-xs" title="Trade">
                      ðŸ’±
                    </a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <th>Token</th>
              <th>Balance</th>
              <th>Price</th>
              <th>Value</th>
              <th>24h Change</th>
              <th>Actions</th>
            </tr>
          </tfoot>
        </table>
      </div>
    {% else %}
      <div class="card bg-base-200">
        <div class="card-body text-center">
          <div class="text-6xl mb-4">ðŸª™</div>
          <h3 class="text-xl font-bold mb-2">No Holdings Yet</h3>
          <p class="text-gray-600 mb-6">Start trading to build your portfolio</p>
          <a href="{{ url_for('web.tokens.tokens_list') }}" class="btn btn-primary">Browse Tokens</a>
        </div>
      </div>
    {% endif %}
  </section>
{% endblock %}
