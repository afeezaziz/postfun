<!doctype html>
<html lang="en" data-theme="terminal">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Postfun{% endblock %}</title>
  {% block meta %}
  <meta property="og:title" content="{{ meta_title or 'Postfun' }}" />
  <meta property="og:description" content="{{ meta_description or 'From posts to markets. Turn vibes into value on Postfun.' }}" />
  <meta property="og:type" content="{{ meta_type or 'website' }}" />
  <meta property="og:url" content="{{ meta_url or request.url }}" />
  {% if meta_image %}
  <meta property="og:image" content="{{ meta_image }}" />
  <meta name="twitter:image" content="{{ meta_image }}" />
  {% endif %}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ meta_title or 'Postfun' }}" />
  <meta name="twitter:description" content="{{ meta_description or 'From posts to markets. Turn vibes into value on Postfun.' }}" />
  <link rel="canonical" href="{{ meta_url or request.url }}" />
  {% endblock %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}" />
  <script defer src="{{ url_for('static', filename='js/app.js') }}?v=20250928-2"></script>
</head>
<body>
  <nav class="navbar bg-base-100 border-b border-terminal-green shadow-lg">
    <div class="navbar-start">
      <div class="dropdown">
        <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" /></svg>
        </div>
        <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52 border border-terminal-green">
          <li><a href="{{ url_for('web.tokens.tokens_list') }}" class="{% if request.endpoint == 'web.tokens.tokens_list' %}text-accent font-bold{% endif %}">Token</a></li>
          <li><a href="{{ url_for('web.tokens.explore') }}" class="{% if request.endpoint == 'web.tokens.explore' %}text-accent font-bold{% endif %}">Explore</a></li>
          <li><a href="{{ url_for('web.tokens.launchpad') }}" class="{% if request.endpoint == 'web.tokens.launchpad' %}text-accent font-bold{% endif %}">Launchpad</a></li>
        </ul>
      </div>
      <a href="{{ url_for('web.main.home') }}" class="btn btn-ghost text-xl font-bold text-terminal-green hover:text-accent transition-colors">Postfun</a>
    </div>
    <div class="navbar-center hidden lg:flex">
      <ul class="menu menu-horizontal px-1">
        <li><a href="{{ url_for('web.tokens.tokens_list') }}" class="text-terminal-green hover:text-accent hover:underline transition-colors {% if request.endpoint == 'web.tokens.tokens_list' %}text-accent font-bold underline{% endif %}">Token</a></li>
        <li><a href="{{ url_for('web.tokens.explore') }}" class="text-terminal-green hover:text-accent hover:underline transition-colors {% if request.endpoint == 'web.tokens.explore' %}text-accent font-bold underline{% endif %}">Explore</a></li>
        <li><a href="{{ url_for('web.tokens.launchpad') }}" class="text-terminal-green hover:text-accent hover:underline transition-colors {% if request.endpoint == 'web.tokens.launchpad' %}text-accent font-bold underline{% endif %}">Launchpad</a></li>
      </ul>
    </div>
    <div class="navbar-end">
      {% if current_user %}
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-outline border-terminal-green text-terminal-green hover:bg-terminal-green hover:text-terminal-black">
            Dashboard
          </div>
          <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-64 border border-terminal-green">
            <li class="menu-title text-terminal-green font-bold">{{ (current_user.npub or current_user.pubkey_hex)[:10] }}...{{ (current_user.npub or current_user.pubkey_hex)[-4:] }}</li>
            <li><a class="text-terminal-green hover:text-accent" href="{{ url_for('web.users.user_profile') }}">Profile</a></li>
            <li><a class="text-terminal-green hover:text-accent" href="{{ url_for('web.users.portfolio') }}">Portfolio</a></li>
            <li><a class="text-terminal-green hover:text-accent" href="{{ url_for('web.users.wallet') }}">Wallet</a></li>
            <div class="divider border-terminal-green"></div>
            <li><button onclick="pfLogout()" class="text-terminal-red hover:text-red-600 font-bold">Logout</button></li>
          </ul>
        </div>
      {% else %}
        <button class="btn btn-outline border-terminal-green text-terminal-green hover:bg-terminal-green hover:text-terminal-black" onclick="pfDashboardLogin()">
          Dashboard
        </button>
      {% endif %}
    </div>
  </nav>

  <main class="container mx-auto px-4 py-8 max-w-6xl pt-24 pb-64">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4 space-y-2">
          {% for category, message in messages %}
            <div class="alert {% if category == 'success' %}bg-terminal-base-200 border-terminal-green text-terminal-green{% elif category == 'error' %}bg-terminal-base-200 border-terminal-red text-terminal-red{% else %}bg-terminal-base-200 border-terminal-green text-terminal-green{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-base-100 border-t border-terminal-green/20 w-full" style="background-color: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px);">
    <!-- Ticker Prices Bar -->
    <div class="bg-terminal-black border-b border-terminal-green/10 overflow-hidden">
      <div class="ticker-tape" id="ticker-tape">
        <div class="ticker-content">
          <!-- Ticker items will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">

      <!-- Bottom bar -->
      <div class="border-t border-terminal-green/10 py-4">
        <div class="flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
          <p class="text-terminal-dim-green text-xs">
            © 2025 Postfun. Built with ❤️ for the community.
          </p>
          <div class="flex items-center space-x-4 text-xs text-terminal-dim-green">
            <span class="text-terminal-green">Decentralized • Nostr • Taproot Asset</span>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <style>
    /* Global layout fixes */
    html {
      height: 100%;
    }

    body {
      min-height: 100vh;
    }

    /* Ticker styles */
    .ticker-tape {
      position: relative;
      height: 40px;
      overflow: hidden;
      background: linear-gradient(90deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 50%, rgba(0,0,0,0.9) 100%);
    }

    .ticker-content {
      display: flex;
      position: absolute;
      animation: scroll-left 30s linear infinite;
      white-space: nowrap;
      will-change: transform;
    }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      padding: 0 2rem;
      color: #0f0;
      font-family: 'VT323', monospace;
      font-size: 18px;
      border-right: 1px solid rgba(0, 255, 0, 0.2);
      min-width: fit-content;
    }

    .ticker-symbol {
      font-weight: bold;
      margin-right: 0.5rem;
      color: #0f0;
    }

    .ticker-price {
      color: #0f0;
      margin-right: 0.5rem;
    }

    .ticker-change {
      margin-left: 0.5rem;
      font-size: 16px;
      font-weight: bold;
    }

    .ticker-change.positive {
      color: #00ff00;
      text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
    }

    .ticker-change.negative {
      color: #ff0000;
      text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
    }

    @keyframes scroll-left {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    .ticker-tape:hover .ticker-content {
      animation-play-state: paused;
    }

    /* Smooth scrolling for main content */
    main {
      scroll-behavior: smooth;
    }
  </style>

  <script>
    // Mock ticker data - in real implementation, this would come from an API
    const tickerData = [
      { symbol: 'BTC', price: 43520.50, change: 2.45 },
      { symbol: 'ETH', price: 2280.30, change: -1.23 },
      { symbol: 'SOL', price: 98.45, change: 5.67 },
      { symbol: 'AVAX', price: 36.78, change: 3.21 },
      { symbol: 'MATIC', price: 0.89, change: -0.45 },
      { symbol: 'LINK', price: 14.56, change: 1.89 },
      { symbol: 'UNI', price: 6.78, change: 4.12 },
      { symbol: 'AAVE', price: 92.34, change: -2.34 },
      { symbol: 'DOT', price: 7.45, change: 0.89 },
      { symbol: 'ATOM', price: 10.23, change: 2.67 },
      { symbol: 'FTM', price: 0.45, change: -1.78 },
      { symbol: 'SAND', price: 0.56, change: 3.45 }
    ];

    function createTickerItem(data) {
      const changeClass = data.change >= 0 ? 'positive' : 'negative';
      const changeSymbol = data.change >= 0 ? '↑' : '↓';

      return `
        <div class="ticker-item">
          <span class="ticker-symbol">${data.symbol}</span>
          <span class="ticker-price">$${data.price.toLocaleString()}</span>
          <span class="ticker-change ${changeClass}">${changeSymbol} ${Math.abs(data.change)}%</span>
        </div>
      `;
    }

    function initializeTicker() {
      const tickerContent = document.querySelector('.ticker-content');

      // Create ticker items (duplicate for seamless looping)
      const tickerItems = tickerData.map(createTickerItem).join('');
      tickerContent.innerHTML = tickerItems + tickerItems; // Duplicate for seamless loop
    }

    // Initialize ticker when DOM is loaded and also check periodically
    function initTickerWhenReady() {
      if (document.querySelector('.ticker-content')) {
        initializeTicker();
      } else {
        setTimeout(initTickerWhenReady, 100);
      }
    }

    // Start initialization
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTickerWhenReady);
    } else {
      initTickerWhenReady();
    }

    // Update prices every 5 seconds (mock implementation)
    setInterval(() => {
      // In real implementation, fetch new prices from API
      tickerData.forEach(item => {
        // Simulate price changes
        const changePercent = (Math.random() - 0.5) * 2; // -1% to +1%
        item.price = item.price * (1 + changePercent / 100);
        item.change = item.change + (Math.random() - 0.5) * 0.5;
      });

      // Reinitialize ticker with new data
      if (document.querySelector('.ticker-content')) {
        initializeTicker();
      }
    }, 5000);
  </script>
</body>
</html>
