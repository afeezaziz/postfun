{% extends 'base.html' %}
{% block title %}Tokens | Postfun{% endblock %}
{% block content %}
  <section class="card">
    <h1>Tokens</h1>

    <!-- Summary Section -->
    <div class="stats shadow">
      <div class="stat place-items-center">
        <div class="stat-title">Total Tokens</div>
        <div class="stat-value">{{ total }}</div>
        <div class="stat-desc">All tokens</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">Showing</div>
        <div class="stat-value">{{ tokens|length }}</div>
        <div class="stat-desc">Current page</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">Total Pages</div>
        <div class="stat-value">{{ pages }}</div>
        <div class="stat-desc">Available</div>
      </div>
      <div class="stat place-items-center">
        <div class="stat-title">Current Page</div>
        <div class="stat-value">{{ page }}</div>
        <div class="stat-desc">of {{ pages }}</div>
      </div>
    </div>

    
    <!-- Data Table -->
    <div class="overflow-x-auto">
      <div class="flex justify-between items-center mb-4 px-4 py-2 bg-base-200 rounded-lg">
        <span class="text-sm">Showing {{ tokens|length }} of {{ total }} tokens</span>
        <span class="text-sm">Page {{ page }} of {{ pages }}</span>
      </div>

      <table class="table table-xs">
        <thead>
          <tr>
            <th></th>
            <th>Symbol</th>
            <th>Name</th>
            <th>Price</th>
            <th>Market Cap</th>
            <th>24h Change</th>
            <th>Chart</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% set start_index = ((page - 1) * per) + 1 %}
          {% for token in tokens %}
            <tr>
              <th>{{ start_index + loop.index0 }}</th>
              <td><span class="badge">{{ token.symbol }}</span></td>
              <td class="pf-token-name">{{ token.name }}</td>
              <td class="pf-price">${{ '%.4f'|format((price_by_symbol.get(token.symbol) if price_by_symbol else None) or (token.price or 0)) }}</td>
              <td class="pf-market-cap">${{ '%.2f'|format(token.market_cap or 0) }}</td>
              <td class="pf-change {% if token.change_24h and token.change_24h > 0 %}pf-positive{% elif token.change_24h and token.change_24h < 0 %}pf-negative{% endif %}">
                {{ '%.2f'|format(token.change_24h or 0) }}%
              </td>
              <td>
                <div class="pf-spark pf-spark-small" data-symbol="{{ token.symbol }}" data-price="{{ (price_by_symbol.get(token.symbol) if price_by_symbol else None) or (token.price or 0) }}"></div>
              </td>
              <td>
                <div class="pf-action-buttons">
                  <a class="retro-button retro-button-small" href="{{ url_for('web.tokens.token_detail', symbol=token.symbol) }}" title="View Details">
                    Details
                  </a>
                  <a class="retro-button retro-button-small" href="{{ url_for('web.trading.pool', symbol=token.symbol) }}" title="View Pool">
                    Pool
                  </a>
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="8" class="pf-no-data">
                <div class="pf-no-data-content">
                  <div>No tokens found</div>
                  <div class="pf-no-data-subtitle">Try adjusting your search criteria</div>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th></th>
            <th>Symbol</th>
            <th>Name</th>
            <th>Price</th>
            <th>Market Cap</th>
            <th>24h Change</th>
            <th>Chart</th>
            <th>Actions</th>
          </tr>
        </tfoot>
      </table>
    </div>
    <div class="pf-pagination">
      <div>Page {{ page }} of {{ pages }} ({{ total }} results)</div>
      <div class="pf-pagination-controls">
        {% set args = request.args.to_dict() %}
        {% if page > 1 %}
          {% set prev_args = args.copy() %}
          {% set _ = prev_args.update({'page': page - 1}) %}
          <a class="retro-button" href="{{ url_for('web.tokens.tokens_list', **prev_args) }}">Prev</a>
        {% endif %}
        {% if page < pages %}
          {% set next_args = args.copy() %}
          {% set _ = next_args.update({'page': page + 1}) %}
          <a class="retro-button" href="{{ url_for('web.tokens.tokens_list', **next_args) }}">Next</a>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock %}
