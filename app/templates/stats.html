{% extends 'base.html' %}
{% block title %}Stats | Postfun{% endblock %}
{% block content %}
  <section class="card">
    <h1>Platform Stats</h1>
    <div class="pf-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
      <div class="card">
        <div>Total Tokens</div>
        <div class="pf-green">{{ num_tokens }}</div>
      </div>
      <div class="card">
        <div>Avg Price</div>
        <div class="pf-green">{{ '%.6f'|format(avg_price) }}</div>
      </div>
      <div class="card">
        <div>Avg Market Cap</div>
        <div class="pf-green">{{ '%.2f'|format(avg_mcap) }}</div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Top by Market Cap</h2>
    <div class="pf-grid">
      {% for t in top_by_mcap %}
        <div class="card pf-token-card">
          <div class="pf-token-header">
            <span class="badge">{{ t.symbol }}</span>
            <span>{{ t.name }}</span>
          </div>
          <div class="pf-token-body">
            <div>Market Cap: <span class="pf-green">{{ '%.2f'|format(t.market_cap or 0) }}</span></div>
          </div>
          <div class="pf-spark" data-symbol="{{ t.symbol }}" data-price="{{ t.price or 0 }}"></div>
          <div class="pf-card-actions">
            <a class="retro-button" href="{{ url_for('web.token_detail', symbol=t.symbol) }}">Details</a>
            <a class="retro-button" href="{{ url_for('web.pool', symbol=t.symbol) }}">Pool</a>
          </div>
        </div>
      {% else %}
        <div>No tokens.</div>
      {% endfor %}
    </div>
  </section>

  <section class="card">
    <h2>Gainers / Losers</h2>
    <div class="pf-grid">
      <div class="card">
        <h3>Gainers</h3>
        {% for t in gainers %}
          <div>
            {{ t.symbol }} — <span class="pf-green">{{ '%.2f'|format(t.change_24h or 0) }}%</span>
            <span style="margin-left:8px;">
              <a href="{{ url_for('web.token_detail', symbol=t.symbol) }}">Details</a> ·
              <a href="{{ url_for('web.pool', symbol=t.symbol) }}">Pool</a>
            </span>
          </div>
        {% else %}
          <div>—</div>
        {% endfor %}
      </div>
      <div class="card">
        <h3>Losers</h3>
        {% for t in losers %}
          <div>
            {{ t.symbol }} — <span class="pf-green">{{ '%.2f'|format(t.change_24h or 0) }}%</span>
            <span style="margin-left:8px;">
              <a href="{{ url_for('web.token_detail', symbol=t.symbol) }}">Details</a> ·
              <a href="{{ url_for('web.pool', symbol=t.symbol) }}">Pool</a>
            </span>
          </div>
        {% else %}
          <div>—</div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Volume Leaders (24h)</h2>
    <div class="pf-grid">
      {% for row in volume_leaders %}
        <div class="card pf-token-card">
          <div class="pf-token-header">
            <span class="badge">{{ row.token.symbol }}</span>
            <span>{{ row.token.name }}</span>
          </div>
          <div class="pf-token-body">
            <div>Volume 24h: <span class="pf-green">{{ '%.2f'|format(row.vol_24h or 0) }}</span></div>
          </div>
          <div class="pf-card-actions">
            <a class="retro-button" href="{{ url_for('web.token_detail', symbol=row.token.symbol) }}">Details</a>
            <a class="retro-button" href="{{ url_for('web.pool', symbol=row.token.symbol) }}">Pool</a>
          </div>
        </div>
      {% else %}
        <div>No data.</div>
      {% endfor %}
    </div>
  </section>

  <section class="card">
    <h2>Stage Leaders</h2>
    <div class="pf-grid">
      {% for row in stage_leaders %}
        <div class="card pf-token-card">
          <div class="pf-token-header">
            <span class="badge">{{ row.token.symbol }}</span>
            <span>{{ row.token.name }}</span>
          </div>
          <div class="pf-token-body">
            <div>Stage: <span class="pf-green">{{ row.stage }}</span></div>
          </div>
          <div class="pf-card-actions">
            <a class="retro-button" href="{{ url_for('web.token_detail', symbol=row.token.symbol) }}">Details</a>
            <a class="retro-button" href="{{ url_for('web.pool', symbol=row.token.symbol) }}">Pool</a>
          </div>
        </div>
      {% else %}
        <div>No data.</div>
      {% endfor %}
    </div>
  </section>
{% endblock %}
