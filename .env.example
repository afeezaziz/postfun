# Flask
SECRET_KEY=dev-secret-change-me
FLASK_DEBUG=1

# Database
# Use DATABASE_URL for a single-string DSN (preferred in production)
# DATABASE_URL=mysql+pymysql://user:password@host:3306/postfun

# Or configure MariaDB components (used if DATABASE_URL is not set)
MARIADB_HOST=
MARIADB_PORT=3306
MARIADB_USER=
MARIADB_PASSWORD=
MARIADB_DB=

# SQLite fallback for local development (used if neither DATABASE_URL nor MariaDB envs are set)
SQLITE_URI=sqlite:///postfun.db

# CORS
CORS_ORIGINS=*

# JWT
JWT_SECRET=super-secret-change-me
JWT_ALGORITHM=HS256
JWT_EXPIRES_SECONDS=86400
# When set to 1/true, cookies set for CSRF are marked secure (HTTPS-only)
JWT_COOKIE_SECURE=0

# Auth challenge (Nostr)
AUTH_CHALLENGE_TTL=600
AUTH_MAX_CLOCK_SKEW=300

# Rate limiting
RATE_LIMIT_DEFAULT=100 per hour
RATE_LIMIT_AUTH=10 per minute
# Storage backend for Flask-Limiter (use Redis in production for multi-process correctness)
# If not set, falls back to in-memory which is per-process only.
# Examples:
# RATELIMIT_STORAGE_URI=redis://localhost:6379/1
# RATELIMIT_STORAGE_URI=redis://:password@redis-host:6379/1
RATELIMIT_STORAGE_URI=

# CSRF
CSRF_COOKIE_NAME=csrf_token

# AMM
# Default max slippage in basis points used by UI when user hasn't specified
AMM_DEFAULT_MAX_SLIPPAGE_BPS=500
# Guardrails to prevent pathological trades
AMM_MIN_TRADE_OUTPUT=0.00000001
AMM_MIN_RESERVE=0.000001

# Cache (Redis recommended for production)
# If REDIS_URL or CACHE_REDIS_URL is set, Flask-Caching will use RedisCache.
# Else it falls back to SimpleCache.
REDIS_URL=
CACHE_REDIS_URL=
CACHE_TYPE=SimpleCache
CACHE_DEFAULT_TIMEOUT=60

# Lightning (LNbits provider)
# See: https://legend.lnbits.com or your self-hosted instance
LNBITS_API_URL=
# Use invoice/read key to create invoices
LNBITS_INVOICE_KEY=
# Use admin key to pay invoices
LNBITS_ADMIN_KEY=
LNBITS_DEFAULT_MEMO=Postfun deposit
# Optional fee cap for withdrawals (sats)
LNBITS_MAX_FEE_SATS=20

# Optional LNbits failover & retry
LNBITS_ALT_API_URL=
LNBITS_ALT_INVOICE_KEY=
LNBITS_ALT_ADMIN_KEY=
LNBITS_RETRY_ATTEMPTS=2
LNBITS_RETRY_BACKOFF_MS=300

# Reconciliation scheduler
# When enabled, background jobs periodically poll LNbits to credit deposits and confirm withdrawals.
SCHEDULER_ENABLED=0
RECONCILE_INTERVAL_SECONDS=60
RECONCILE_INVOICES_MIN_AGE_SEC=30
RECONCILE_WITHDRAW_MIN_AGE_SEC=30

# Idempotency usage (no env var):
# Send header "Idempotency-Key: <unique-id>" to POST /api/lightning/deposit and /api/lightning/withdraw
# to safely retry without creating duplicates. The API also accepts body field idempotency_key if header isn't set.
